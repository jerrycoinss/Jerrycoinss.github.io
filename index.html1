<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jerry Smart Matrix</title>
<style>
body {
  font-family: 'Roboto', sans-serif;
  margin:0; padding:0;
  background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
  color: #fff;
}
header {
  text-align: center;
  padding: 30px 20px;
  background: rgba(0,0,0,0.6);
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}
header h1 {
  color: gold;
  font-size: 2.2rem;
  margin: 0;
  text-shadow: 0 0 12px #ffd700;
}
header img {
  width: 80px; margin-top: 10px;
}
.container {
  padding: 20px; max-width: 600px; margin: auto;
}
.btn {
  background: gold; color:black; font-weight:bold;
  padding: 15px 20px; margin:10px 0;
  border:none; border-radius:12px;
  cursor:pointer; width:100%; font-size:1rem;
  transition: all 0.3s ease; box-shadow:0 4px 6px rgba(0,0,0,0.3);
}
.btn:hover { background:#ffdf00; transform: scale(1.05); }
.card {
  background: rgba(255,255,255,0.05);
  padding: 20px; border-radius:15px; margin-bottom:15px;
  box-shadow:0 4px 8px rgba(0,0,0,0.2);
}
h2 { color: gold; margin-bottom: 10px; text-shadow: 0 0 8px #ffd700; }
.level-btn { background: #ffbf00; color:black; margin-top:5px; }
.info { margin-bottom: 10px; }
.level-icon {
  width: 24px; vertical-align:middle; margin-right:5px;
}
</style>
</head>
<body>

<header>
  <h1>Jerry Smart Matrix</h1>
  <!-- صورة شعار مدمجة Base64 -->
  <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABaCAYAAABx..." alt="Jerry Logo">
</header>

<div class="container">
  <button class="btn" id="connectBtn">Connect Wallet</button>

  <div class="card">
    <h2>User Info</h2>
    <div class="info"><strong>Address:</strong> <span id="userAddress">Not connected</span></div>
    <div class="info"><strong>Levels:</strong> <span id="userLevels">-</span></div>
    <div class="info"><strong>Referrals:</strong> <span id="userReferrals">-</span></div>
  </div>

  <div class="card">
    <h2>Buy Levels</h2>
    <div id="levelsContainer"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
<script>
const contractAddress = "0xB963CA4f5d123a1622f6D6ABd80c4bef85c90D12";
const contractABI = [
  {"inputs":[{"internalType":"address","name":"_token","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},
  {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"level","type":"uint256"}],"name":"LevelPurchased","type":"event"},
  {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Payout","type":"event"},
  {"inputs":[{"internalType":"uint256","name":"level","type":"uint256"}],"name":"buyLevel","outputs":[],"stateMutability":"nonpayable","type":"function"},
  {"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserLevels","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserReferrals","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"uint256","name":"level","type":"uint256"}],"name":"levelPrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"checkUserExists","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"}
];

let provider, signer, contract, userAddress;

async function connectWallet() {
    try {
        if (typeof window.ethereum !== 'undefined') {
            await window.ethereum.request({ method: 'eth_requestAccounts' });
            provider = new ethers.providers.Web3Provider(window.ethereum);
            signer = provider.getSigner();
            userAddress = await signer.getAddress();
            document.getElementById("userAddress").innerText = userAddress;
            contract = new ethers.Contract(contractAddress, contractABI, signer);
            loadLevels();
            getUserInfo();
            alert("Wallet connected: " + userAddress);
        } else {
            alert("Please install MetaMask!");
        }
    } catch (err) {
        console.error(err);
        alert("Failed to connect wallet: " + err.message);
    }
}

async function getUserInfo(){
  try{
    const levels = await contract.getUserLevels(userAddress);
    document.getElementById("userLevels").innerText = levels.join(", ")||"-";
    const referrals = await contract.getUserReferrals(userAddress);
    document.getElementById("userReferrals").innerText = referrals.join(", ")||"-";
  } catch(err) {
    console.error(err);
    document.getElementById("userLevels").innerText="Error";
    document.getElementById("userReferrals").innerText="Error";
  }
}

async function loadLevels(){
  try{
    const maxLevel=11;
    const container=document.getElementById("levelsContainer");
    container.innerHTML="";
    for(let i=1;i<=maxLevel;i++){
      const price=await contract.levelPrice(i);
      const btn=document.createElement("button");
      btn.className="btn level-btn";
      btn.innerHTML=`Level ${i} - ${ethers.utils.formatUnits(price,18)} JD`;
      btn.onclick=()=>buyLevel(i);
      container.appendChild(btn);
    }
  } catch(err){console.error(err);}
}

async function buyLevel(level){
  try{
    const tx = await contract.buyLevel(level);
    await tx.wait();
    alert(`Level ${level} purchased successfully!`);
    getUserInfo();
  } catch(err){console.error(err); alert("Transaction failed!");}
}

document.getElementById("connectBtn").addEventListener("click", connectWallet);
</script>

</body>
  </html>
