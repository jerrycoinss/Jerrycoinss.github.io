<script>
        // --- الإعدادات الأساسية ---
        const contractAddress = "0x5aF2Ec60b61061202Fa6907EaEd309284F587C5b";
        const contractABI = [
            "function levelPrice(uint256) view returns (uint256)"
        ];

        // --- الوصول لعناصر الصفحة ---
        const connectButton = document.getElementById('connectButton');
        const dataContainer = document.getElementById('dataContainer');
        
        let provider;
        let contract;

        // --- الدوال الرئيسية ---

        // دالة لربط المحفظة
        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    
                    // -- السطر الذي تم تصحيحه --
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    // -------------------------

                    contract = new ethers.Contract(contractAddress, contractABI, provider);
                    
                    connectButton.textContent = "✅ تم الربط بنجاح";
                    console.log("Wallet connected!");

                    await readContractData();

                } catch (error) {
                    console.error("User rejected request or error occurred:", error);
                    connectButton.textContent = "فشل الربط";
                }
            } else {
                alert("الرجاء تثبيت MetaMask!");
                connectButton.textContent = "MetaMask غير موجود";
            }
        }

        // دالة لقراءة سعر المستوى الأول
        async function readContractData() {
            try {
                const priceBigNumber = await contract.levelPrice(1);
                const priceFormatted = ethers.utils.formatEther(priceBigNumber);

                dataContainer.innerHTML = `سعر المستوى الأول هو: <strong>${priceFormatted} JERRY</strong>`;
                console.log("Level 1 Price:", priceFormatted);

            } catch (error) {
                console.error("Could not fetch level price:", error);
                dataContainer.textContent = "حدث خطأ أثناء قراءة البيانات.";
            }
        }

        // --- ربط الدالة بالزر ---
        connectButton.addEventListener('click', connectWallet);
</script>
