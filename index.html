<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù‚Ø¯ Ø§Ù„Ø°ÙƒÙŠ</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 50px; }
        button { font-size: 18px; padding: 10px 20px; cursor: pointer; }
        #dataContainer { margin-top: 30px; font-size: 22px; color: #333; }
    </style>
</head>
<body>

    <h1>Ù…Ø´Ø±ÙˆØ¹ÙŠ Ø§Ù„Ù„Ø§Ù…Ø±ÙƒØ²ÙŠ</h1>
    <p>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ù„Ø±Ø¨Ø· Ù…Ø­ÙØ¸ØªÙƒ ÙˆÙ‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø¹Ù‚Ø¯.</p>

    <button id="connectButton">ğŸ”— Ø±Ø¨Ø· Ø§Ù„Ù…Ø­ÙØ¸Ø©</button>

    <div id="dataContainer"></div>

    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"
            type="application/javascript"></script>

    <script>
        // --- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ---
        const contractAddress = "0x5aF2Ec60b61061202Fa6907EaEd309284F587C5b";

        // ABI: ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ©. Ù‡ÙŠ "Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø±" Ø§Ù„ØªÙŠ ÙŠÙÙ‡Ù…Ù‡Ø§ Ø§Ù„Ø¹Ù‚Ø¯.
        // Ù†Ø¶Ø¹ ÙÙ‚Ø· Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙŠ Ù†Ø±ÙŠØ¯ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ Ø§Ù„Ø¢Ù†.
        const contractABI = [
            "function levelPrice(uint256) view returns (uint256)"
        ];

        // --- Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙØ­Ø© ---
        const connectButton = document.getElementById('connectButton');
        const dataContainer = document.getElementById('dataContainer');
        
        let provider;
        let contract;

        // --- Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ---

        // Ø¯Ø§Ù„Ø© Ù„Ø±Ø¨Ø· Ø§Ù„Ù…Ø­ÙØ¸Ø©
        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    // Ø·Ù„Ø¨ Ø±Ø¨Ø· Ø­Ø³Ø§Ø¨Ø§Øª Ù…ÙŠØªØ§Ù…Ø§Ø³Ùƒ
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    
                    // Ø¨Ø¹Ø¯ Ø§Ù„Ø±Ø¨Ø·ØŒ Ù†Ù‚ÙˆÙ… Ø¨Ø¥Ø¹Ø¯Ø§Ø¯ ÙƒÙ„ Ø´ÙŠØ¡
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    contract = new ethers.Contract(contractAddress, contractABI, provider);
                    
                    connectButton.textContent = "âœ… ØªÙ… Ø§Ù„Ø±Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­";
                    console.log("Wallet connected!");

                    // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    await readContractData();

                } catch (error) {
                    console.error("User rejected request:", error);
                    connectButton.textContent = "ÙØ´Ù„ Ø§Ù„Ø±Ø¨Ø·";
                }
            } else {
                alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ«Ø¨ÙŠØª MetaMask!");
                connectButton.textContent = "MetaMask ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯";
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„Ù‚Ø±Ø§Ø¡Ø© Ø³Ø¹Ø± Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„
        async function readContractData() {
            try {
                // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© levelPrice Ù…Ù† Ø§Ù„Ø¹Ù‚Ø¯ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ 1
                const priceBigNumber = await contract.levelPrice(1);
                
                // Ø³Ø¹Ø± Ø§Ù„Ø¹Ù…Ù„Ø© ÙŠØ£ØªÙŠ ÙƒØ±Ù‚Ù… Ø¶Ø®Ù… Ø¨Ù€ 18 ØµÙØ± (Wei). Ù†Ø­ÙˆÙ„Ù‡ Ø¥Ù„Ù‰ Ø±Ù‚Ù… Ø¹Ø§Ø¯ÙŠ.
                const priceFormatted = ethers.utils.formatEther(priceBigNumber);

                // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©
                dataContainer.innerHTML = `Ø³Ø¹Ø± Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„ Ù‡Ùˆ: <strong>${priceFormatted} JERRY</strong>`;
                console.log("Level 1 Price:", priceFormatted);

            } catch (error) {
                console.error("Could not fetch level price:", error);
                dataContainer.textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.";
            }
        }

        // --- Ø±Ø¨Ø· Ø§Ù„Ø¯Ø§Ù„Ø© Ø¨Ø§Ù„Ø²Ø± ---
        connectButton.addEventListener('click', connectWallet);

    </script>
</body>
</html>
